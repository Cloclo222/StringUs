#ifndef __Scara_H__
#define __Scara_H__

#include <Dynamixel2Arduino.h>
#include "Arduino.h"

//Nos variables
#define moteur_gauche 1
#define moteur_droit 2
#define moteur_table 3
#define UP 180
#define DOWN 0

using namespace ControlTableItem;
#define DXL_SERIAL   Serial1

class Scara
{
private:
    Dynamixel2Arduino &_dxl;
    const float DXL_PROTOCOL_VERSION = 2.0;
    int Pos_default[3] = {2560, 2560, 0};
    int Pos_current[3] = {0, 0, 0};
    int SpeedAccel[2] = {0, 0};
    
    

public:
    int range = 491;
    int seqCalib[100][2];
    int jointDefaultLeft[2] = {2825,1925};
    int jointDefaultRight[2] = {1952,2800};
    int seqClou[2][100][2] = {{{2823, 1921},
{2822, 1918},
{2822, 1915},
{2822, 1913},
{2822, 1908},
{2821, 1904},
{2822, 1900},
{2822, 1898},
{2822, 1894},
{2823, 1891},
{2824, 1888},
{2824, 1884},
{2825, 1880},
{2825, 1876},
{2825, 1872},
{2825, 1869},
{2828, 1866},
{2832, 1865},
{2836, 1865},
{2840, 1864},
{2845, 1864},
{2847, 1863},
{2852, 1863},
{2855, 1861},
{2859, 1859},
{2862, 1856},
{2866, 1854},
{2869, 1851},
{2874, 1850},
{2878, 1849},
{2883, 1849},
{2889, 1849},
{2893, 1849},
{2897, 1849},
{2901, 1849},
{2905, 1849},
{2911, 1849},
{2917, 1851},
{2923, 1852},
{2928, 1854},
{2933, 1855},
{2936, 1856},
{2939, 1858},
{2941, 1860},
{2943, 1862},
{2944, 1864},
{2945, 1867},
{2946, 1871},
{2947, 1875},
{2949, 1880},
{2952, 1885},
{2954, 1889},
{2954, 1892},
{2952, 1895},
{2950, 1898},
{2949, 1901},
{2949, 1905},
{2949, 1908},
{2948, 1911},
{2948, 1914},
{2947, 1918},
{2944, 1919},
{2940, 1921},
{2935, 1921},
{2931, 1922},
{2927, 1923},
{2923, 1925},
{2920, 1926},
{2916, 1928},
{2914, 1930},
{2911, 1932},
{2908, 1933},
{2906, 1933},
{2902, 1934},
{2899, 1935},
{2895, 1936},
{2890, 1936},
{2886, 1936},
{2883, 1936},
{2879, 1936},
{2876, 1936},
{2874, 1936},
{2871, 1936},
{2869, 1936},
{2868, 1936},
{2866, 1935},
{2864, 1935},
{2863, 1936},
{2860, 1935},
{2857, 1935},
{2852, 1934},
{2847, 1934},
{2843, 1934},
{2840, 1934},
{2837, 1934},
{2833, 1934},
{2828, 1934},
{2824, 1934},
{2819, 1934},
{2825, 1925}},
{{1947, 2799},
{1944, 2800},
{1941, 2800},
{1938, 2802},
{1934, 2803},
{1931, 2806},
{1927, 2808},
{1922, 2810},
{1917, 2812},
{1914, 2814},
{1912, 2816},
{1911, 2818},
{1906, 2820},
{1904, 2822},
{1902, 2824},
{1901, 2827},
{1898, 2829},
{1896, 2830},
{1892, 2833},
{1890, 2834},
{1888, 2837},
{1887, 2840},
{1885, 2845},
{1884, 2851},
{1882, 2857},
{1881, 2861},
{1881, 2865},
{1881, 2868},
{1883, 2871},
{1885, 2874},
{1886, 2877},
{1888, 2882},
{1889, 2884},
{1891, 2886},
{1894, 2888},
{1897, 2890},
{1901, 2891},
{1904, 2891},
{1908, 2891},
{1911, 2893},
{1914, 2898},
{1917, 2903},
{1920, 2907},
{1924, 2909},
{1930, 2910},
{1934, 2910},
{1937, 2909},
{1940, 2909},
{1943, 2909},
{1945, 2907},
{1946, 2905},
{1948, 2903},
{1949, 2900},
{1949, 2897},
{1950, 2892},
{1950, 2886},
{1952, 2883},
{1955, 2880},
{1959, 2876},
{1963, 2869},
{1965, 2863},
{1967, 2856},
{1969, 2850},
{1971, 2844},
{1974, 2839},
{1977, 2834},
{1979, 2830},
{1982, 2827},
{1984, 2824},
{1986, 2821},
{1986, 2816},
{1986, 2812},
{1987, 2809},
{1987, 2805},
{1988, 2802},
{1988, 2798},
{1987, 2795},
{1987, 2791},
{1985, 2788},
{1986, 2784},
{1985, 2779},
{1984, 2776},
{1983, 2773},
{1982, 2770},
{1982, 2768},
{1983, 2766},
{1981, 2763},
{1980, 2758},
{1979, 2753},
{1979, 2751},
{1979, 2749},
{1978, 2744},
{1976, 2739},
{1975, 2734},
{1973, 2730},
{1972, 2726},
{1971, 2724},
{1971, 2723},
{1971, 2719},
{1952, 2800}}}; 
    Scara(Dynamixel2Arduino &dxl);
    ~Scara();
    void init_com();
    void init_moteur();
    void update();
    void setScaraPos(int jointPos[2]);
    void doSeq(int side);
    void setTablePos(int TablePos);
    void jointisPos(int jointPos[2]);
    void tableisPos(int TablePos);
    int* getLastCmd(); 
    float getDxlPos(int moteur);
    void toggleTorque(int i);
    void move(float cmd[2]);
    bool buildInvJacobienne();
    void printPosition();
    void sendDefaultPos();
    void setSpeed(uint8_t speedLimitRight, uint8_t speedLimitLeft);
    void setSpeedForLinearMov(int jointPos[2], uint8_t speedLimit);
    void setAcceleration(uint8_t AccelLimitBras, uint8_t AccelLimitTable);
    int* getSpeedAccel();
    void homing();

};

#endif //__SCARA_H__
