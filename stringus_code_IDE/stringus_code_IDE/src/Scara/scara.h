#ifndef __Scara_H__
#define __Scara_H__

#include <Dynamixel2Arduino.h>
#include "Arduino.h"

//Nos variables
#define moteur_gauche 1
#define moteur_droit 2
#define moteur_table 3
#define UP 180
#define DOWN 0

using namespace ControlTableItem;
#define DXL_SERIAL   Serial1

class Scara
{
private:
    Dynamixel2Arduino &_dxl;
    const float DXL_PROTOCOL_VERSION = 2.0;
    int Pos_default[3] = {2560, 2560, 0};
    int Pos_current[3] = {0, 0, 0};
    int SpeedAccel[2] = {0, 0};
    
    

public:
    int range = 491;
    int seqCalib[100][2];
    int jointDefaultLeft[2] = {2825,1925};
    int jointDefaultRight[2] = {1952,2800};
    int seqClou[2][100][2] = {{{2822, 1915},
{2822, 1909},
{2822, 1903},
{2822, 1897},
{2822, 1894},
{2823, 1892},
{2831, 1887},
{2834, 1885},
{2838, 1884},
{2841, 1882},
{2843, 1882},
{2844, 1882},
{2846, 1881},
{2849, 1881},
{2852, 1880},
{2853, 1878},
{2854, 1872},
{2855, 1868},
{2856, 1865},
{2858, 1863},
{2859, 1862},
{2861, 1861},
{2863, 1860},
{2864, 1859},
{2871, 1856},
{2874, 1855},
{2878, 1854},
{2882, 1853},
{2886, 1853},
{2889, 1853},
{2894, 1853},
{2898, 1853},
{2904, 1853},
{2910, 1853},
{2916, 1853},
{2922, 1853},
{2927, 1853},
{2931, 1853},
{2936, 1853},
{2939, 1853},
{2940, 1855},
{2942, 1857},
{2942, 1859},
{2942, 1860},
{2941, 1863},
{2941, 1866},
{2941, 1870},
{2941, 1874},
{2941, 1878},
{2941, 1881},
{2940, 1884},
{2940, 1887},
{2939, 1891},
{2939, 1894},
{2939, 1898},
{2938, 1900},
{2938, 1902},
{2937, 1904},
{2936, 1906},
{2935, 1910},
{2933, 1913},
{2930, 1915},
{2928, 1916},
{2925, 1919},
{2922, 1921},
{2919, 1924},
{2917, 1927},
{2915, 1928},
{2913, 1929},
{2910, 1929},
{2907, 1930},
{2904, 1930},
{2901, 1930},
{2899, 1931},
{2896, 1933},
{2893, 1936},
{2890, 1937},
{2887, 1940},
{2883, 1942},
{2880, 1944},
{2876, 1948},
{2873, 1951},
{2871, 1954},
{2869, 1956},
{2868, 1957},
{2865, 1958},
{2861, 1959},
{2857, 1960},
{2852, 1962},
{2844, 1964},
{2838, 1964},
{2834, 1965},
{2831, 1965},
{2830, 1964},
{2828, 1965},
{2826, 1965},
{2824, 1965},
{2822, 1966},
{2819, 1968},
{2816, 1969},},
{{1947, 2799},
{1944, 2800},
{1941, 2800},
{1938, 2802},
{1934, 2803},
{1931, 2806},
{1927, 2808},
{1922, 2810},
{1917, 2812},
{1914, 2814},
{1912, 2816},
{1911, 2818},
{1906, 2820},
{1904, 2822},
{1902, 2824},
{1901, 2827},
{1898, 2829},
{1896, 2830},
{1892, 2833},
{1890, 2834},
{1888, 2837},
{1887, 2840},
{1885, 2845},
{1884, 2851},
{1882, 2857},
{1881, 2861},
{1881, 2865},
{1881, 2868},
{1883, 2871},
{1885, 2874},
{1886, 2877},
{1888, 2882},
{1889, 2884},
{1891, 2886},
{1894, 2888},
{1897, 2890},
{1901, 2891},
{1904, 2891},
{1908, 2891},
{1911, 2893},
{1914, 2898},
{1917, 2903},
{1920, 2907},
{1924, 2909},
{1930, 2910},
{1934, 2910},
{1937, 2909},
{1940, 2909},
{1943, 2909},
{1945, 2907},
{1946, 2905},
{1948, 2903},
{1949, 2900},
{1949, 2897},
{1950, 2892},
{1950, 2886},
{1952, 2883},
{1955, 2880},
{1959, 2876},
{1963, 2869},
{1965, 2863},
{1967, 2856},
{1969, 2850},
{1971, 2844},
{1974, 2839},
{1977, 2834},
{1979, 2830},
{1982, 2827},
{1984, 2824},
{1986, 2821},
{1986, 2816},
{1986, 2812},
{1987, 2809},
{1987, 2805},
{1988, 2802},
{1988, 2798},
{1987, 2795},
{1987, 2791},
{1985, 2788},
{1986, 2784},
{1985, 2779},
{1984, 2776},
{1983, 2773},
{1982, 2770},
{1982, 2768},
{1983, 2766},
{1981, 2763},
{1980, 2758},
{1979, 2753},
{1979, 2751},
{1979, 2749},
{1978, 2744},
{1976, 2739},
{1975, 2734},
{1973, 2730},
{1972, 2726},
{1971, 2724},
{1971, 2723},
{1971, 2719},
{1952, 2800}}}; 
    Scara(Dynamixel2Arduino &dxl);
    ~Scara();
    void init_com();
    void init_moteur();
    void update();
    void setScaraPos(int jointPos[2]);
    void doSeq(int side);
    void setTablePos(int TablePos);
    void jointisPos(int jointPos[2]);
    void tableisPos(int TablePos);
    int* getLastCmd(); 
    float getDxlPos(int moteur);
    void toggleTorque(int i);
    void move(float cmd[2]);
    bool buildInvJacobienne();
    void printPosition();
    void sendDefaultPos();
    void setSpeed(uint8_t speedLimitRight, uint8_t speedLimitLeft);
    void setSpeedForLinearMov(int jointPos[2], uint8_t speedLimit);
    void setAcceleration(uint8_t AccelLimitBras, uint8_t AccelLimitTable);
    int* getSpeedAccel();
    void homing();

};

#endif //__SCARA_H__
