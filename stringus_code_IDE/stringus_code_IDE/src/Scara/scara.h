#ifndef __Scara_H__
#define __Scara_H__

#include <Dynamixel2Arduino.h>
#include "Arduino.h"

//Nos variables
#define moteur_gauche 1
#define moteur_droit 2
#define moteur_table 3
#define UP 180
#define DOWN 0
#define SCARA_SEQ_RES 50 // number of positions for circle sequence

using namespace ControlTableItem;
#define DXL_SERIAL   Serial1

class Scara
{
private:
    Dynamixel2Arduino &_dxl;
    const float DXL_PROTOCOL_VERSION = 2.0;
    int Pos_default[3] = {2560, 2560, 0};
    int Pos_current[3] = {0, 0, 0};
    int SpeedAccel[2] = {0, 0};
    
    

public:
    int range = 491;
    int seqCalib[100][2];
    uint16_t LeftApproach[2];
    uint16_t RightApproach[2];
    uint16_t seqClou[2][50][2];
    //uint16_t LeftApproach[2] = {2825,1925};
    //uint16_t RightApproach[2] = {1952,2800};
//     uint16_t seqClou[2][100][2] = {{{2831, 1929},
// {2835, 1930},
// {2839, 1930},
// {2845, 1931},
// {2852, 1932},
// {2860, 1934},
// {2867, 1937},
// {2873, 1940},
// {2878, 1943},
// {2883, 1947},
// {2889, 1948},
// {2895, 1948},
// {2901, 1948},
// {2906, 1947},
// {2911, 1945},
// {2917, 1943},
// {2921, 1941},
// {2928, 1937},
// {2935, 1932},
// {2943, 1926},
// {2950, 1918},
// {2958, 1911},
// {2966, 1905},
// {2973, 1899},
// {2980, 1893},
// {2986, 1886},
// {2993, 1878},
// {2997, 1869},
// {2999, 1860},
// {2999, 1851},
// {2999, 1842},
// {2998, 1835},
// {2996, 1831},
// {2992, 1829},
// {2985, 1829},
// {2980, 1828},
// {2972, 1828},
// {2963, 1828},
// {2956, 1828},
// {2948, 1827},
// {2940, 1828},
// {2933, 1828},
// {2927, 1828},
// {2921, 1828},
// {2914, 1828},
// {2904, 1829},
// {2894, 1830},
// {2883, 1831},
// {2874, 1834},
// {2865, 1836},
// {2857, 1840},
// {2850, 1845},
// {2842, 1849},
// {2835, 1855},
// {2828, 1860},
// {2820, 1867},
// {2813, 1873},
// {2807, 1881},
// {2802, 1886},
// {2798, 1892},
// {2795, 1897},
// {2792, 1902},
// {2788, 1906},
// {2786, 1911},
// {2783, 1915},
// {2782, 1918},
// {2780, 1921},
// {2777, 1923},
// {2774, 1925},
// {2771, 1925},
// {2768, 1925},
// {2766, 1924},
// {2762, 1925},
// {2759, 1926},
// {2756, 1927},
// {2753, 1931},
// {2751, 1938},
// {2749, 1943},
// {2746, 1950},
// {2744, 1951},
// {2743, 1951},
// {2740, 1953},
// {2733, 1953},
// {2732, 1953},
// {2734, 1948},
// {2739, 1942},
// {2746, 1941},
// {2753, 1939},
// {2758, 1939},
// {2761, 1939},
// {2764, 1939},
// {2767, 1939},
// {2771, 1938},
// {2773, 1937},
// {2774, 1937},
// {2772, 1942},
// {2771, 1947},
// {2768, 1952},
// {2766, 1956},
// {2763, 1958}},
// {{1953, 2807},
// {1953, 2811},
// {1953, 2814},
// {1953, 2818},
// {1953, 2821},
// {1953, 2824},
// {1953, 2829},
// {1952, 2833},
// {1951, 2841},
// {1948, 2846},
// {1946, 2852},
// {1945, 2856},
// {1945, 2862},
// {1943, 2866},
// {1942, 2870},
// {1938, 2871},
// {1934, 2874},
// {1928, 2879},
// {1924, 2883},
// {1919, 2885},
// {1916, 2888},
// {1914, 2889},
// {1911, 2891},
// {1907, 2896},
// {1901, 2902},
// {1894, 2907},
// {1886, 2911},
// {1877, 2913},
// {1870, 2915},
// {1863, 2915},
// {1857, 2915},
// {1853, 2914},
// {1849, 2913},
// {1847, 2912},
// {1847, 2909},
// {1847, 2904},
// {1847, 2900},
// {1847, 2896},
// {1847, 2893},
// {1846, 2892},
// {1846, 2889},
// {1846, 2886},
// {1845, 2885},
// {1845, 2883},
// {1845, 2878},
// {1845, 2873},
// {1846, 2869},
// {1846, 2865},
// {1847, 2860},
// {1847, 2854},
// {1849, 2848},
// {1850, 2843},
// {1852, 2838},
// {1853, 2833},
// {1855, 2828},
// {1856, 2821},
// {1856, 2814},
// {1856, 2808},
// {1857, 2803},
// {1858, 2800},
// {1861, 2794},
// {1863, 2788},
// {1864, 2782},
// {1864, 2776},
// {1864, 2770},
// {1865, 2764},
// {1867, 2758},
// {1870, 2752},
// {1874, 2748},
// {1876, 2744},
// {1878, 2740},
// {1882, 2737},
// {1883, 2733},
// {1886, 2730},
// {1889, 2727},
// {1893, 2722},
// {1898, 2716},
// {1902, 2709},
// {1906, 2704},
// {1908, 2701},
// {1909, 2699},
// {1908, 2698},
// {1909, 2694},
// {1909, 2691},
// {1910, 2686},
// {1910, 2682},
// {1910, 2679},
// {1912, 2678},
// {1915, 2675},
// {1915, 2670},
// {1915, 2663},
// {1916, 2657},
// {1918, 2652},
// {1921, 2650},
// {1924, 2648},
// {1926, 2646},
// {1927, 2644},
// {1927, 2640},
// {1927, 2636},
// {1929, 2633}}}; 
    Scara(Dynamixel2Arduino &dxl);
    ~Scara();
    void init_com();
    void init_moteur();
    void update();
    void setScaraPos(int jointPos[2]);
    void doSeq(int side);
    void setTablePos(int TablePos);
    void jointisPos(int jointPos[2]);
    void tableisPos(int TablePos);
    int* getLastCmd(); 
    float getDxlPos(int moteur);
    void toggleTorque(int i);
    void move(float cmd[2]);
    bool buildInvJacobienne();
    void printPosition();
    void sendDefaultPos();
    void setSpeed(uint8_t speedLimitRight, uint8_t speedLimitLeft);
    void setTableSpeed(uint8_t speedLimitTable);
    void setSpeedForLinearMov(int jointPos[2], uint8_t speedLimit);
    void setAcceleration(uint8_t AccelLimitBras, uint8_t AccelLimitTable);
    int* getSpeedAccel();
    void homing();

};

#endif //__SCARA_H__
